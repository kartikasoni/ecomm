{% extends "app/base.html" %}
{% load static %}
{% block title %}Your Orders · My Shop{% endblock %}

{% block content %}

<div class="page-content">

  <!--start breadcrumb-->
  <div class="py-4 border-bottom">
    <div class="container">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0"> 
          <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
          <li class="breadcrumb-item"><a href="{% url 'product_list' %}">Shop</a></li>
          <li class="breadcrumb-item active" aria-current="page">Orders</li>
        </ol>
      </nav>
    </div>
  </div>
  <!--end breadcrumb-->

  <section class="section-padding">
    <div class="container">
      <div class="d-flex align-items-center px-3 py-2 border mb-4">
        <div class="text-start">
          <h4 class="mb-0 h4 fw-bold">Account - Orders</h4>
        </div>
      </div>

      <div class="btn btn-dark btn-ecomm d-xl-none position-fixed top-50 start-0 translate-middle-y"  
           data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbarFilter">
        <span><i class="bi bi-person me-2"></i>Account</span>
      </div>

      <div class="row">
        <!-- Sidebar -->
        <div class="col-12 col-xl-3 filter-column">
          <nav class="navbar navbar-expand-xl flex-wrap p-0">
            <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbarFilter">
              <div class="offcanvas-header">
                <h5 class="offcanvas-title fw-bold text-uppercase">Account</h5>
                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"></button>
              </div>
              <div class="offcanvas-body account-menu">
                <div class="list-group w-100 rounded-0">
                  <a href="{% url 'account_dashboard' %}" class="list-group-item"><i class="bi bi-house-door me-2"></i>Dashboard</a>
                  <a href="{% url 'order_list' %}" class="list-group-item active"><i class="bi bi-basket3 me-2"></i>Orders</a>
                  <a href="{% url 'profile' %}" class="list-group-item"><i class="bi bi-person me-2"></i>Profile</a>
                  <a href="{% url 'edit_profile' %}" class="list-group-item"><i class="bi bi-pencil me-2"></i>Edit Profile</a>
                  <a href="{% url 'saved_address' %}" class="list-group-item"><i class="bi bi-pin-map me-2"></i>Saved Address</a>
                  <a href="{% url 'wishlist' %}" class="list-group-item"><i class="bi bi-suit-heart me-2"></i>Wishlist</a>
                  <a href="{% url 'logout' %}" class="list-group-item"><i class="bi bi-power me-2"></i>Logout</a>
                </div>
              </div>
            </div>
          </nav>
        </div>

        <!-- Orders Section -->
        <div class="col-12 col-xl-9">

          <!-- Search and Filter Bar -->
          <div class="card rounded-0 mb-3 bg-light">
            <div class="card-body">
              <div class="d-flex flex-column flex-xl-row gap-3 align-items-center">
                <div>
                  <h5 class="mb-1 fw-bold">All Orders</h5>
                  <p class="mb-0">for anytime</p>
                </div>
                <div class="order-search flex-grow-1">
                  <form method="get" action="">
                    <div class="position-relative">
                      <input type="text" name="q" class="form-control ps-5 rounded-0" placeholder="Search Product...">
                      <span class="position-absolute top-50 product-show translate-middle-y"><i class="bi bi-search ms-3"></i></span>
                    </div>
                  </form>
                </div>
                <div class="filter">
                  <button type="button" class="btn btn-dark rounded-0" data-bs-toggle="modal" data-bs-target="#FilterOrders">
                    <i class="bi bi-filter me-2"></i>Filter
                  </button>
                </div>
              </div>
            </div>
          </div>

          {% if orders %}
            {% for o in orders %}
              <div class="card rounded-3 shadow-sm mb-4 border-0">
                <div class="card-header bg-white border-0 d-flex flex-wrap justify-content-between align-items-center">
                  <div>
                    <span class="fw-bold h5">Order #{{ o.order_id }}</span>
                    <span class="badge ms-2 {% if o.order_status == 'delivered' %}bg-success{% elif o.order_status == 'pending' %}bg-warning text-dark{% elif o.order_status == 'cancelled' %}bg-danger{% else %}bg-secondary{% endif %}">{{ o.order_status|title }}</span>
                    <span class="badge ms-1 {% if o.payment_status == 'completed' %}bg-success{% elif o.payment_status == 'pending' %}bg-warning text-dark{% else %}bg-danger{% endif %}">{{ o.payment_status|title }}</span>
                  </div>
                  <div class="text-muted small">
                    {{ o.created_at|date:"M d, Y H:i" }}<br>
                    <span class="text-secondary">{{ o.payment_method|title }}</span>
                  </div>
                </div>
                <div class="card-body pt-0">
                  <div class="row g-3 align-items-center">
                    <div class="col-12 col-md-4 col-lg-3">
                      <div class="d-flex flex-wrap gap-2">
                        {% for item in o.items.all %}
                          <div class="border rounded p-1 bg-light d-inline-block">
                            {% if item.product.image_url %}
                              <img src="{{ item.product.image_url.url }}" width="60" height="60" style="object-fit:cover;" alt="{{ item.product.name }}">
                            {% else %}
                              <img src="{% static 'app/images/no-image.png' %}" width="60" height="60" style="object-fit:cover;" alt="No image">
                            {% endif %}
                          </div>
                        {% endfor %}
                      </div>
                    </div>
                    <div class="col-12 col-md-8 col-lg-6">
                      <table class="table table-borderless mb-0 small align-middle">
                        <thead>
                          <tr class="text-secondary">
                            <th>Product</th>
                            <th>Qty</th>
                            <th>Subtotal</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for item in o.items.all %}
                          <tr>
                            <td class="fw-semibold">{{ item.product.name }}</td>
                            <td>x{{ item.quantity }}</td>
                            <td>₹{{ item.subtotal }}</td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                    <div class="col-12 col-lg-3">
                      <div class="mb-2">
                        <span class="fw-bold">Total:</span> ₹{{ o.total_amount }}
                      </div>
                      <div class="mb-2">
                        <span class="fw-bold">To:</span> {{ o.full_name }}<br>
                        <span class="text-secondary small">{{ o.address }}, {{ o.city }}, {{ o.state }} - {{ o.pincode }}</span>
                      </div>
                      <div class="mb-2">
                        <span class="fw-bold">Contact:</span> {{ o.phone }}<br>
                        <span class="fw-bold">Email:</span> {{ o.email }}
                      </div>
                      <div class="d-flex gap-2 mt-2">
                        <a href="{% url 'order_detail' o.order_id %}" class="btn btn-outline-dark btn-sm">View Details</a>
                        {% if o.order_status == 'pending' or o.order_status == 'confirmed' %}
                          <a href="{% url 'cancel_order' o.order_id %}" class="btn btn-outline-danger btn-sm">Cancel</a>
                        {% endif %}
                        <a href="{% url 'product_list' %}?reorder={{ o.order_id }}" class="btn btn-outline-primary btn-sm">Reorder</a>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="card-footer bg-white border-0">
                  <div class="d-flex align-items-center gap-2">
                    <span class="fw-bold me-2">Rate this Order:</span>
                    <div class="ratings">
                      {% for i in "12345" %}
                        {% if o.rating|default:0|add:0 >= i|add:0 %}
                          <i class="bi bi-star-fill text-warning h6"></i>
                        {% else %}
                          <i class="bi bi-star h6"></i>
                        {% endif %}
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <div class="text-center py-5">
              <img src="{% static 'app/images/empty-orders.svg' %}" alt="No Orders" style="max-width:180px;">
              <div class="mt-3 mb-2 h5">You haven’t placed any orders yet.</div>
              <a class="btn btn-primary" href="{% url 'product_list' %}">Start Shopping</a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </section>

  <!-- Filter Modal -->
  <div class="modal" id="FilterOrders" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content rounded-0">
        <div class="modal-header">
          <h5 class="modal-title fw-bold">Filter Orders</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <h6 class="mb-3 fw-bold">Status</h6>
          <div class="status-radio d-flex flex-column gap-2">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="status" id="status_all" checked>
              <label class="form-check-label" for="status_all">All</label>
            </div>
            <div class="form-check"><input class="form-check-input" type="radio" name="status" id="status_onway"><label class="form-check-label" for="status_onway">On the way</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="status" id="status_delivered"><label class="form-check-label" for="status_delivered">Delivered</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="status" id="status_cancelled"><label class="form-check-label" for="status_cancelled">Cancelled</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="status" id="status_returned"><label class="form-check-label" for="status_returned">Returned</label></div>
          </div>
          <hr>
          <h6 class="mb-3 fw-bold">Time</h6>
          <div class="status-radio d-flex flex-column gap-2">
            <div class="form-check"><input class="form-check-input" type="radio" name="time" id="time_any" checked><label class="form-check-label" for="time_any">Anytime</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="time" id="time_30"><label class="form-check-label" for="time_30">Last 30 days</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="time" id="time_6months"><label class="form-check-label" for="time_6months">Last 6 months</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="time" id="time_year"><label class="form-check-label" for="time_year">Last year</label></div>
          </div>
        </div>
        <div class="modal-footer">
          <div class="d-flex gap-3 w-100">
            <button type="button" class="btn btn-outline-dark w-50">Clear Filters</button>
            <button type="button" class="btn btn-dark w-50">Apply</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}
