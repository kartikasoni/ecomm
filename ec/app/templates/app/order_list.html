{% extends "app/base.html" %}
{% block title %}Your Orders · My Shop{% endblock %}

{% block content %}

<div class="page-content">

  <!--start breadcrumb-->
  <div class="py-4 border-bottom">
    <div class="container">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0"> 
          <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
          <li class="breadcrumb-item"><a href="{% url 'product_list' %}">Shop</a></li>
          <li class="breadcrumb-item active" aria-current="page">Orders</li>
        </ol>
      </nav>
    </div>
  </div>
  <!--end breadcrumb-->

  <section class="section-padding">
    <div class="container">
      <div class="d-flex align-items-center px-3 py-2 border mb-4">
        <div class="text-start">
          <h4 class="mb-0 h4 fw-bold">Account - Orders</h4>
        </div>
      </div>

      <div class="btn btn-dark btn-ecomm d-xl-none position-fixed top-50 start-0 translate-middle-y"  
           data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbarFilter">
        <span><i class="bi bi-person me-2"></i>Account</span>
      </div>

      <div class="row">
        <!-- Sidebar -->
        <div class="col-12 col-xl-3 filter-column">
          <nav class="navbar navbar-expand-xl flex-wrap p-0">
            <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbarFilter">
              <div class="offcanvas-header">
                <h5 class="offcanvas-title fw-bold text-uppercase">Account</h5>
                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"></button>
              </div>
              <div class="offcanvas-body account-menu">
                <div class="list-group w-100 rounded-0">
                  <a href="{% url 'account_dashboard' %}" class="list-group-item"><i class="bi bi-house-door me-2"></i>Dashboard</a>
                  <a href="{% url 'order_history' %}" class="list-group-item active"><i class="bi bi-basket3 me-2"></i>Orders</a>
                  <a href="{% url 'profile' %}" class="list-group-item"><i class="bi bi-person me-2"></i>Profile</a>
                  <a href="{% url 'edit_profile' %}" class="list-group-item"><i class="bi bi-pencil me-2"></i>Edit Profile</a>
                  <a href="{% url 'saved_address' %}" class="list-group-item"><i class="bi bi-pin-map me-2"></i>Saved Address</a>
                  <a href="{% url 'wishlist' %}" class="list-group-item"><i class="bi bi-suit-heart me-2"></i>Wishlist</a>
                  <a href="{% url 'logout' %}" class="list-group-item"><i class="bi bi-power me-2"></i>Logout</a>
                </div>
              </div>
            </div>
          </nav>
        </div>

        <!-- Orders Section -->
        <div class="col-12 col-xl-9">

          <!-- Search and Filter Bar -->
          <div class="card rounded-0 mb-3 bg-light">
            <div class="card-body">
              <div class="d-flex flex-column flex-xl-row gap-3 align-items-center">
                <div>
                  <h5 class="mb-1 fw-bold">All Orders</h5>
                  <p class="mb-0">for anytime</p>
                </div>
                <div class="order-search flex-grow-1">
                  <form method="get" action="">
                    <div class="position-relative">
                      <input type="text" name="q" class="form-control ps-5 rounded-0" placeholder="Search Product...">
                      <span class="position-absolute top-50 product-show translate-middle-y"><i class="bi bi-search ms-3"></i></span>
                    </div>
                  </form>
                </div>
                <div class="filter">
                  <button type="button" class="btn btn-dark rounded-0" data-bs-toggle="modal" data-bs-target="#FilterOrders">
                    <i class="bi bi-filter me-2"></i>Filter
                  </button>
                </div>
              </div>
            </div>
          </div>

          {% if orders %}
            {% for o in orders %}
              <div class="card rounded-0 mb-3">
                <div class="card-body">
                  <div class="d-flex flex-column flex-xl-row gap-3">
                    <div class="product-img">
                      {% if o.product.image %}
                        <img src="{{ o.product.image.url }}" width="120" alt="{{ o.product.name }}">
                      {% else %}
                        <img src="{% static 'app/images/no-image.png' %}" width="120" alt="No image">
                      {% endif %}
                    </div>
                    <div class="product-info flex-grow-1">
                      <h5 class="fw-bold mb-1">{{ o.product.name }}</h5>
                      <p class="mb-0">Order #{{ o.order_id }} | ₹{{ o.total_amount }}</p>
                      <p class="mb-0">Status: {{ o.order_status|title }} | Payment: {{ o.payment_status|title }}</p>
                      <small class="text-muted">{{ o.created_at|date:"M d, Y H:i" }}</small>
                      <div class="mt-3 hstack gap-2">
                        <button type="button" class="btn btn-sm border rounded-0">Qty : {{ o.quantity }}</button>
                      </div>
                    </div>
                    <div class="d-none d-xl-block vr"></div>
                    <div class="d-grid align-self-start align-self-xl-center">
                      <a href="{% url 'order_detail' o.order_id %}" class="btn btn-outline-dark btn-ecomm">View Details</a>
                    </div>
                  </div>
                </div>
                <div class="card-footer bg-transparent">
                  <div class="d-flex align-items-center gap-3">
                    <p class="mb-1 fw-bold">Rate this Product</p>
                    <div class="ratings">
                      {% for i in "12345" %}
                        {% if i|add:0 <= o.rating %}
                          <i class="bi bi-star-fill text-warning h6"></i>
                        {% else %}
                          <i class="bi bi-star h6"></i>
                        {% endif %}
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <div class="alert alert-info text-center">You haven’t placed any orders yet.</div>
            <div class="text-center">
              <a class="btn btn-primary" href="{% url 'product_list' %}">Start Shopping</a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </section>

  <!-- Filter Modal -->
  <div class="modal" id="FilterOrders" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content rounded-0">
        <div class="modal-header">
          <h5 class="modal-title fw-bold">Filter Orders</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <h6 class="mb-3 fw-bold">Status</h6>
          <div class="status-radio d-flex flex-column gap-2">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="status" id="status_all" checked>
              <label class="form-check-label" for="status_all">All</label>
            </div>
            <div class="form-check"><input class="form-check-input" type="radio" name="status" id="status_onway"><label class="form-check-label" for="status_onway">On the way</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="status" id="status_delivered"><label class="form-check-label" for="status_delivered">Delivered</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="status" id="status_cancelled"><label class="form-check-label" for="status_cancelled">Cancelled</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="status" id="status_returned"><label class="form-check-label" for="status_returned">Returned</label></div>
          </div>
          <hr>
          <h6 class="mb-3 fw-bold">Time</h6>
          <div class="status-radio d-flex flex-column gap-2">
            <div class="form-check"><input class="form-check-input" type="radio" name="time" id="time_any" checked><label class="form-check-label" for="time_any">Anytime</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="time" id="time_30"><label class="form-check-label" for="time_30">Last 30 days</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="time" id="time_6months"><label class="form-check-label" for="time_6months">Last 6 months</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="time" id="time_year"><label class="form-check-label" for="time_year">Last year</label></div>
          </div>
        </div>
        <div class="modal-footer">
          <div class="d-flex gap-3 w-100">
            <button type="button" class="btn btn-outline-dark w-50">Clear Filters</button>
            <button type="button" class="btn btn-dark w-50">Apply</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock main-content %}
